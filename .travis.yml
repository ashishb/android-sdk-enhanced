# https://stackoverflow.com/questions/27644586/how-to-set-up-travis-ci-with-multiple-languages
matrix:
  include:
    - language: Java # OpenJDK9 testing (Android language on Travis does not support JDK8)
      python:
        - 3.7
      sudo: required  # For pip installation, otherwise, pip install fails.
      jdk: oraclejdk9
#      before_cache:
#        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
#        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
#      # https://docs.travis-ci.com/user/languages/android/#caching
#      cache:
#        directories:
#        - $HOME/.gradle/caches/
#        - $HOME/.gradle/wrapper/
#      android:
#        components:
#        - tools
#        - platform-tools
      before_script:
        - sudo apt-get install python3-pip
        - pip3 install --user -r requirements.txt
        - jdk_switcher use oraclejdk9
      script:
        # Assert failure
        - python3 src/main.py doctor --verbose && exit 1 || exit 0

    - language: android # Doctor testing
      python:
        - 3.7
      sudo: required  # For pip installation, otherwise, pip install fails.
      jdk: oraclejdk8
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      # https://docs.travis-ci.com/user/languages/android/#caching
      cache:
        directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
#      android:
#        components:
#        - tools
#        - platform-tools
      before_script:
        - sudo apt-get install python3-pip
        - pip3 install --user -r requirements.txt
        - jdk_switcher use oraclejdk8
      script:
        - python3 src/main.py install basic packages --verbose
        - python3 src/main.py doctor --verbose

    - language: android # list testing
      python:
      - 3.7
      sudo: required  # For pip installation, otherwise, pip install fails.
      jdk: oraclejdk8
      before_cache:
      - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
      - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      # https://docs.travis-ci.com/user/languages/android/#caching
      cache:
          directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
      #      android:
      #        components:
      #        - tools
      #        - platform-tools
      before_script:
      - sudo apt-get install python3-pip
      - pip3 install --user -r requirements.txt
      - jdk_switcher use oraclejdk8
      script:
      - python3 src/main.py list api versions --arm
      - python3 src/main.py list build tools
      - python3 src/main.py list installed packages
      - python3 src/main.py list other packages

    - language: android # Install testing
      python:
      - 3.7
      sudo: required  # For pip installation, otherwise, pip install fails.
      jdk: oraclejdk8
      before_cache:
      - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
      - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      # https://docs.travis-ci.com/user/languages/android/#caching
      cache:
          directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
      before_script:
      - sudo apt-get install python3-pip
      - pip3 install --user -r requirements.txt
      - jdk_switcher use oraclejdk8
      script:
      - python3 src/main.py install version 4 --verbose
      - python3 src/main.py install version 14 --arm
      - python3 src/main.py install version 27 --x86
      - python3 src/main.py list installed packages
      # TODO(ashishb): Make this work, for now, it just hangs.
      # - python3 src/main.py update all --verbose